// Add these models to your existing schema.prisma

// ============================================================================
// SCENE BUILDER MODELS
// ============================================================================

model Scene {
  id          String   @id @default(uuid())
  userId      String
  
  // Metadata
  title       String   @db.VarChar(200)
  description String?  @db.Text
  
  // Original generation data
  originalPrompt String @db.Text
  
  // Scene configuration fields
  escena      String   @db.Text
  fondo       String?  @db.Text
  accion      String   @db.Text
  dialogo     String   @db.Text
  voiceStyle  String?  @db.VarChar(100)
  movimiento  String?  @db.Text
  suggestedDuration Int  // 2, 4, 6, or 8
  
  // Pro/hyper-realism fields
  condicionesFisicas String? @db.Text
  defectosTecnicos   String? @db.Text
  contextoInvisible  String? @db.Text
  
  // Usage tracking
  timesUsed   Int      @default(0)
  lastUsedAt  DateTime?
  
  // Organization
  isFavorite  Boolean  @default(false)
  tags        String[] @default([])
  folder      String?  @db.VarChar(100)
  
  // Generation metadata
  tokensUsed  Int      @default(0)
  costMxn     Decimal  @default(0) @db.Decimal(10, 2)
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  generations Generation[] @relation("SceneGenerations")
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId, createdAt])
  @@index([userId, isFavorite])
  @@index([userId, folder])
  @@map("scenes")
}

model Story {
  id          String   @id @default(uuid())
  userId      String
  
  // Metadata
  storyTitle       String   @db.VarChar(200)
  storyDescription String?  @db.Text
  
  // Original generation data
  originalPrompt String @db.Text
  segmentCount   Int    // How many segments requested
  
  // Story segments (stored as JSON array)
  // Each segment has: segmentNumber, title, escena, fondo, accion, dialogo, 
  // voiceStyle, movimiento, condicionesFisicas, defectosTecnicos, 
  // contextoInvisible, suggestedDuration
  segments       Json
  
  // Usage tracking
  timesUsed      Int      @default(0)
  lastUsedAt     DateTime?
  
  // Organization
  isFavorite     Boolean  @default(false)
  tags           String[] @default([])
  folder         String?  @db.VarChar(100)
  
  // Generation metadata
  tokensUsed     Int      @default(0)
  costMxn        Decimal  @default(0) @db.Decimal(10, 2)
  
  // Relations
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  generations    Generation[] @relation("StoryGenerations")
  
  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  @@index([userId, createdAt])
  @@index([userId, isFavorite])
  @@index([userId, folder])
  @@map("stories")
}

// ============================================================================
// UPDATE EXISTING MODELS
// ============================================================================

// Add to User model:
// scenes      Scene[]
// stories     Story[]

// Add to Generation model (optional - to link generations to saved scenes/stories):
// sceneId     String?
// storyId     String?
// scene       Scene?   @relation("SceneGenerations", fields: [sceneId], references: [id])
// story       Story?   @relation("StoryGenerations", fields: [storyId], references: [id])
